# Что такое Prometheus и почему он так популярен?

![](https://itsecforu.ru/wp-content/uploads/2021/12/Prometheus-2-870x400.png) [Статьи](https://itsecforu.ru/category/%d1%81%d1%82%d0%b0%d1%82%d1%8c%d0%b8/)

Автор cryptoparty На чтение 6 мин Опубликовано 20.12.2021

Prometheus – это решение для мониторинга с открытым исходным кодом для сбора и агрегирования метрик в виде временных рядов данных.

Проще говоря, каждый элемент в хранилище Prometheus – это метрическое событие, сопровождаемое временной меткой его возникновения.

Prometheus был первоначально разработан в компании Soundcloud, но сейчас это проект сообщества, поддерживаемый Cloud Native Computing Foundation (CNCF).

За последнее десятилетие он быстро приобрел известность, поскольку сочетание функций запросов и “облачной” архитектуры сделало его идеальным стеком мониторинга для современных приложений.

В этой статье мы объясним роль Prometheus, расскажем, как он хранит и предоставляет данные, и выделим, где заканчивается ответственность Prometheus.

Отчасти его популярность объясняется совместимостью с другими платформами, которые могут предоставлять данные в более удобных форматах.

Содержание

1.  [Что делает Prometheus?](https://itsecforu.ru/2021/12/20/%f0%9f%97%bd-%d1%87%d1%82%d0%be-%d1%82%d0%b0%d0%ba%d0%be%d0%b5-prometheus-%d0%b8-%d0%bf%d0%be%d1%87%d0%b5%d0%bc%d1%83-%d0%be%d0%bd-%d1%82%d0%b0%d0%ba-%d0%bf%d0%be%d0%bf%d1%83%d0%bb%d1%8f%d1%80%d0%b5/#chto-delaet-prometheus)
2.  [Подробнее об экспортерах](https://itsecforu.ru/2021/12/20/%f0%9f%97%bd-%d1%87%d1%82%d0%be-%d1%82%d0%b0%d0%ba%d0%be%d0%b5-prometheus-%d0%b8-%d0%bf%d0%be%d1%87%d0%b5%d0%bc%d1%83-%d0%be%d0%bd-%d1%82%d0%b0%d0%ba-%d0%bf%d0%be%d0%bf%d1%83%d0%bb%d1%8f%d1%80%d0%b5/#podrobnee-ob-eksporterah)
3.  [Запрос данных Prometheus](https://itsecforu.ru/2021/12/20/%f0%9f%97%bd-%d1%87%d1%82%d0%be-%d1%82%d0%b0%d0%ba%d0%be%d0%b5-prometheus-%d0%b8-%d0%bf%d0%be%d1%87%d0%b5%d0%bc%d1%83-%d0%be%d0%bd-%d1%82%d0%b0%d0%ba-%d0%bf%d0%be%d0%bf%d1%83%d0%bb%d1%8f%d1%80%d0%b5/#zapros-dannyh-prometheus)
4.  [Алерты](https://itsecforu.ru/2021/12/20/%f0%9f%97%bd-%d1%87%d1%82%d0%be-%d1%82%d0%b0%d0%ba%d0%be%d0%b5-prometheus-%d0%b8-%d0%bf%d0%be%d1%87%d0%b5%d0%bc%d1%83-%d0%be%d0%bd-%d1%82%d0%b0%d0%ba-%d0%bf%d0%be%d0%bf%d1%83%d0%bb%d1%8f%d1%80%d0%b5/#alerty)
5.  [Чего не может Prometheus?](https://itsecforu.ru/2021/12/20/%f0%9f%97%bd-%d1%87%d1%82%d0%be-%d1%82%d0%b0%d0%ba%d0%be%d0%b5-prometheus-%d0%b8-%d0%bf%d0%be%d1%87%d0%b5%d0%bc%d1%83-%d0%be%d0%bd-%d1%82%d0%b0%d0%ba-%d0%bf%d0%be%d0%bf%d1%83%d0%bb%d1%8f%d1%80%d0%b5/#chego-ne-mozhet-prometheus)
6.  [Заключение](https://itsecforu.ru/2021/12/20/%f0%9f%97%bd-%d1%87%d1%82%d0%be-%d1%82%d0%b0%d0%ba%d0%be%d0%b5-prometheus-%d0%b8-%d0%bf%d0%be%d1%87%d0%b5%d0%bc%d1%83-%d0%be%d0%bd-%d1%82%d0%b0%d0%ba-%d0%bf%d0%be%d0%bf%d1%83%d0%bb%d1%8f%d1%80%d0%b5/#zaklyuchenie)

### Что делает Prometheus?

Prometheus хранит события в режиме реального времени. Эти события могут быть любыми, имеющими отношение к вашему приложению, например, потребление памяти, использование сети или отдельные входящие запросы.

Основной единицей данных является “метрика”. Каждой метрике присваивается имя, на которое можно ссылаться, а также набор меток. Метки – это произвольные пары данных “ключ-значение”, которые можно использовать для фильтрации метрик в вашей базе данных.

Метрики всегда основаны на одном из четырех основных типов инструментов:

*   **Counter**– значение, которое постоянно увеличивается, никогда не уменьшается и не сбрасывается.
*   **Gauge**  – значение, которое может изменяться в любом направлении в любое время.
*   **Histogram** – выборка из нескольких значений, которая обеспечивает сумму всех сохраненных значений, а также подсчет зарегистрированных событий.
*   **Summary**  – Сводка функционирует аналогично гистограмме, но поддерживает настраиваемые квантили для совокупного мониторинга за скользящие периоды времени.

Prometheus определяет текущее значение ваших метрик с помощью механизма получения данных на основе извлечения.

Он периодически опрашивает источник данных, который поддерживает каждую метрику, а затем сохраняет результат как новое событие в базе данных временных рядов.

Мониторируемое приложение отвечает за реализацию конечной точки, используемой в качестве источника данных; такие поставщики данных обычно называются экспортерами.

[![☸️](https://s.w.org/images/core/emoji/13.0.1/svg/2638.svg) Как установить Prometheus и Grafana на Kubernetes с помощью Helm 3](https://itsecforu.ru/2021/04/12/%e2%98%b8%ef%b8%8f-%d0%ba%d0%b0%d0%ba-%d1%83%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%b8%d1%82%d1%8c-prometheus-%d0%b8-grafana-%d0%bd%d0%b0-kubernetes-%d1%81-%d0%bf%d0%be%d0%bc%d0%be%d1%89%d1%8c%d1%8e-h/)

Модель на основе извлечения упрощает интеграцию Prometheus в ваши приложения.

Все, что вам нужно сделать, это предоставить совместимую конечную точку, которая отображает текущее значение метрики для сбора.

Все остальное Prometheus берет на себя.

Хотя это может привести к неэффективности – например, если Prometheus снова опросит конечную точку до того, как данные изменятся, – это означает, что вашему коду не нужно обрабатывать транспортировку метрик.

![](https://itsecforu.ru/wp-content/uploads/2021/12/prometheus.png)

### Подробнее об экспортерах

Экспортеры отвечают за отображение метрик вашего приложения, готовых для сбора Prometheus.

Многие пользователи начинают с простого развертывания Node Exporter, который собирает основные системные метрики с Linux-хоста, на котором он установлен.

Доступен широкий спектр экспортеров, многие из которых предоставляются самим Prometheus или официальными поставщиками сообщества.

Если вы отслеживаете популярный механизм баз данных, такой как MySQL, PostgreSQL и MongoDB, или отслеживаете HTTP-сервер, механизм регистрации или шину обмена сообщениями, велика вероятность того, что экспортер уже существует.

[Как контролировать веб-сервер Apache с помощью Prometheus и Grafana за 5 минут](https://itsecforu.ru/2018/11/22/%d0%ba%d0%b0%d0%ba-%d0%ba%d0%be%d0%bd%d1%82%d1%80%d0%be%d0%bb%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d1%82%d1%8c-%d0%b2%d0%b5%d0%b1-%d1%81%d0%b5%d1%80%d0%b2%d0%b5%d1%80-apache-%d1%81-%d0%bf%d0%be%d0%bc%d0%be/)

Вы можете отслеживать собственные метрики вашего приложения, написав свой собственный экспортер.

При таком подходе нет никаких ограничений – вы можете отслеживать время, проведенное на целевой странице, объем продаж, регистрацию пользователей или все остальное, что важно для вашей системы.

Экспортеры – это простые конечные точки HTTP API, поэтому они могут быть созданы на любом языке программирования.

Prometheus предоставляет официальные клиентские библиотеки для Go, Java/Scala, Python и Ruby, которые облегчают инструментарий вашего кода.

Инициативы сообщества предоставили неофициальные библиотеки для большинства других популярных языков.

### Запрос данных Prometheus

Данные в Prometheus запрашиваются с помощью PromQL, встроенного языка запросов, который позволяет выбирать, анализировать и форматировать метрики с помощью различных операторов и функций.

Поскольку Prometheus использует хранение временных рядов, поддерживается выбор диапазона времени и продолжительности, что позволяет легко находить данные, добавленные за определенный период времени.

Вот пример, который отображает все события memory\_consumption за последний час:

```
memory_consumption[1h]
```

В этом примере отображаются только события потребления памяти, записанные за последний час.

Вы можете фильтровать по метке, добавляя пары ключ-значение внутри фигурных скобок:

```
memory_consumption{app="api"}[1h]
```

Встроенные функции предоставляют возможности для более точного анализа.

Вот пример, в котором функция rate() используется для расчета скорости увеличения метрики memory\_consumption за выбранный период времени:

```
rate(memory_consumption[1h])
```

Доступ к данным Prometheus можно получить с помощью встроенного веб-интерфейса, обычно открываемого через порт 9090, или HTTP API.

Последний обеспечивает надежный способ получения данных из Prometheus в другие инструменты, например, в дашборды.

[![🗽](https://s.w.org/images/core/emoji/13.0.1/svg/1f5fd.svg) Интеграция Prometheus и Grafana для Мониторинга логов](https://itsecforu.ru/2019/06/03/%f0%9f%93%a6-%d0%b8%d0%bd%d1%82%d0%b5%d0%b3%d1%80%d0%b0%d1%86%d0%b8%d1%8f-prometheus-%d0%b8-grafana-%d0%b4%d0%bb%d1%8f-%d0%bc%d0%be%d0%bd%d0%b8%d1%82%d0%be%d1%80%d0%b8%d0%bd%d0%b3%d0%b0-%d0%bb%d0%be/)

### Алерты

Prometheus поставляется с компонентом Alertmanager, который может отправлять вам уведомления при изменении метрик.

Он поддерживает политики на основе правил, которые определяют, когда следует отправлять оповещение.

Вы можете получать оповещения на адрес электронной почты, произвольные HTTP-вебхуки и популярные платформы обмена сообщениями, такие как Slack.

Alertmanager включает встроенную поддержку агрегирования и отключения повторяющихся оповещений, чтобы вы не были перегружены, когда несколько событий происходят в короткий промежуток времени.

Alertmanager настраивается независимо от основной системы Prometheus.

Вы устанавливаете правила оповещения в Prometheus, определяя условия, когда метрика должна отправить оповещение в Alertmanager.

Последний компонент затем принимает решение о том, следует ли доставлять оповещение на каждую настроенную платформу.

![](https://itsecforu.ru/wp-content/uploads/2021/12/alert-manager-prometheus.png)

### Чего не может Prometheus?

Хотя Prometheus является комплексным решением для мониторинга, есть некоторые функции, для которых он не подходит.

Prometheus разработан с учетом надежности и производительности в качестве основных принципов.

Это приводит к компромиссам в точности показателей.

Prometheus не гарантирует, что собранные данные будут на 100% точными.

Он предназначен для сценариев с большим объемом работы, где случайные падения не влияют на общую картину.

Если вы отслеживаете важные статистические данные, которые должны быть точными, вам следует использовать другую платформу для этих показателей. Вы можете использовать Prometheus для менее важных значений в вашей системе.

Кроме того, Prometheus может быть не единственным компонентом, который вам нужен в вашем стеке мониторинга.

Он сосредоточен на хранении и запросе ваших событий, в основном с использованием HTTP API.

Встроенный веб-интерфейс предоставляет базовые возможности построения графиков, но не может поддерживать продвинутые пользовательские панели.

Сценарии визуализации данных обычно решаются путем развертывания параллельно экземпляра Grafana, который предоставляет возможности построения информационных панелей и анализа метрик со встроенной интеграцией с Prometheus.

*   [![☸️](https://s.w.org/images/core/emoji/13.0.1/svg/2638.svg) Как настроить Grafana на Kubernetes](https://itsecforu.ru/2020/01/28/%e2%98%b8%ef%b8%8f-%d0%ba%d0%b0%d0%ba-%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b8%d1%82%d1%8c-grafana-%d0%bd%d0%b0-kubernetes/)
*   [![🐳](https://s.w.org/images/core/emoji/13.0.1/svg/1f433.svg) Как сбросить пароль администратора в Docker контейнере Grafana](https://itsecforu.ru/2020/01/09/%f0%9f%90%b3-%d0%ba%d0%b0%d0%ba-%d1%81%d0%b1%d1%80%d0%be%d1%81%d0%b8%d1%82%d1%8c-%d0%bf%d0%b0%d1%80%d0%be%d0%bb%d1%8c-%d0%b0%d0%b4%d0%bc%d0%b8%d0%bd%d0%b8%d1%81%d1%82%d1%80%d0%b0%d1%82%d0%be%d1%80/)

### Заключение

В самом простом виде Prometheus – это хранилище данных временных рядов, которое можно использовать для управления любыми последовательными данными, основанными на времени.

Чаще всего он используется для мониторинга метрик других приложений в вашем стеке.

Хотя Prometheus является эффективной системой для хранения и запроса метрик, он обычно интегрируется с другими решениями для создания графических панелей и расширенных визуализаций.

Его популярность объясняется способностью работать с пользовательскими метриками, поддерживать насыщенные запросы и взаимодействовать с другими участниками экосистемы облачных решений.
